# Processor emulator

## Description

This bundle provides assembling, disassembling, executing and debugging code written in simplified intel assembler version. It consists of 3 modules, compiled at the same time into a different executables. Let's take a closer look on these:

### Assembler
This module compiles specified by source into a binary file. Also it generates compilation listing that consists information about line, opcode and instruction pointer of the instruction and file header.

### Disassembler
Decompiles binary file into a disassembly file with binary header, instructions pointers of commands and commands themself

### Processor
Provides functionality for executing and debugging precompiled binaries

## Installation

### Dependencies
To compile this repository you have [sfml 2.6](https://www.sfml-dev.org/index.php "sfml") or higher and [GNU readline](https://tiswww.case.edu/php/chet/readline/rltop.html "GNU readline") to be installed on your computer. [Cmake](https://cmake.org/) is used for building project, so you need to install it as well. Current version of a program works only on GNU/Linux (tested on arch and ubuntu).

### Downloading
To download emulator simply clone it's [GitHub repository](https://github.com/Iprime111/Processor) and `cd` to Processor folder:
```bash
$ git clone https://github.com/Iprime111/Processor.git
$ cd Processor
```
Then, to download static libraries run:
```bash
$ git submodule update --init --remote --recursive
```

### Building
Cmake in this project currently doesn't have Release/Debug building options, so to build it, run cmake from the build directory:
``` bash
$ mkdir build
$ cmake ..
$ cmake --build .
```
All the binaries will be saved into the `build/bin` folder.

## Usage

There are some examples of modules usage (assuming you're in build folder). Flags order does not matter for all of the modules.

> Warning: Only one source, listing, binary or output can be specified for each module. Specifying more than one can lead to the undefined behaviour

### Assembler

To compile file with source code you have to specify it's location using `-s` or `--source` flag. If output binary path is not set by `-o` or `--output`, compiler will generate `a.out` file in your current folder. Listing will not be generated, unless you use `-l` or `--listing` flag to set it's location. Here's most common example of using assembler:
``` bash
$ ./bin/Assembler -s /path/to/source -o /path/to/binary -l /path/to/listing
```

You can also write debug information into a binary file by using `-d` or `--debug` compilation flag

> Warning: writing debug info can make file size extremly big

Debug mode assembly example:

``` bash
$ ./bin/Assembler -s /path/to/source -o /path/to/binary -l /path/to/listing --debug
```

### Disassembler

 Disassembler needs binary file to be specified with `-b` or `--binary` flag. Also you can set output disassembly file with `-o` or `--output`. Default output file name is `a.disasm`.

 Usage example:

 ``` bash
$ ./bin/Disassembler -b /path/to/binary -o /path/to/output
 ```

### Processor

This program has a bit more console flags than previous ones. List of them, their functions and accepted values is presented below:

| short flag name | long flag name | flag function                                        | accepted value                                      |
|-----------------|----------------|------------------------------------------------------|-----------------------------------------------------|
| `-b`            | `--binary`     | sets a binary file for executing                     | path to a binary file                               |
| `-s`            | `--source`     | sets a source file (needed for debugging)            | path to a source file                               |
| `-f`            | `--frequency`  | sets processor frequency (ram latency simulation)    | integer number betweent 1 and 4200 (defaul: 4200)   |
| `-d`            | `--debug`      | runs program in debug mode                           | no arguments                                        |
| `-g`            | `--graphics`   | enables sfml graphics (GPU emulation)                | no arguments                                        |

Usage example:

``` bash
$ ./bin/SoftProcessor -b /path/to/binary -s /path/to/source -f 4200 --debug --graphics
```

## Processor usage details

There are some small details in processor usage that you have to take into account:

### Debug mode

To correctly debug compiled binary file you have to use `--debug` when assembling and running program. If no debug info has been found in binary file but `--debug` flag has been set when running processor, it will launch disassembler to decompile binary and let you debug it's decompiled version. Auto-generated disassembly will be situated by the `./disassembly_autogenerated.tmp` path.

> Warning: in current version processor is trying to find disassembler in the same folder (assuming they're stored together). Undefined behaviour can occure if processor is launched from another folder

### Graphics mode

Processor uses sfml to display image from virtual `VRAM`. Each three `VRAM` adresses corresponds to a one pixel's colors. (`VRAM` adresses are `0~300`)

## Assembler syntax
